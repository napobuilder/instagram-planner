<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Captain Candy Visualizer - Final Copies Update</title>
    
    <!-- OPTIMIZACI√ìN: Pre-conectar -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://esm.sh">
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://i.imgur.com">

    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Import Map -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.292.0"
      }
    }
    </script>

    <!-- 3. Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        @keyframes pulse-custom {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: .5; transform: scale(0.95); }
        }
        .animate-loader {
            animation: pulse-custom 1s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Asegurar que videos no cargados mantengan su espacio */
        video { background: #1f2937; }
        
        /* Animaci√≥n de barra de progreso de historia */
        @keyframes progress {
            from { width: 0%; }
            to { width: 100%; }
        }
        .animate-progress {
            animation: progress linear forwards;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-white transition-colors duration-300">
    
    <div id="root"></div>

    <!-- 4. REACT APP -->
    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { Heart, MessageCircle, Grid, Film, Layers, X, Download, Calendar, Target, Crown, Gem, Star, MapPin, Ticket, ChevronLeft, ChevronRight, AlertTriangle, ExternalLink, Play, Pause, Cookie } from 'lucide-react';

        const MAIN_DRIVE_FOLDER = 'https://drive.google.com/drive/folders/17AmAK1bz3NqVhLCOoU3NRmGmsG4Gv6g8?usp=drive_link';

        // --- DATA DE HISTORIAS ---
        const STORIES_DATA = {
            'Boutique': [
                { type: 'image', url: 'https://i.imgur.com/hUbk3tk.png', duration: 5000 }, 
                { type: 'image', url: 'https://i.imgur.com/4zlKVOp.png', duration: 5000 }
            ],
            'Chocolates': [
                { type: 'image', url: 'https://i.imgur.com/cODXWwD.jpeg', duration: 5000 },
                { type: 'video', url: 'https://i.imgur.com/o2zykFg.mp4', duration: 10000 }
            ],
            'Reviews': [
                 { type: 'image', url: 'https://i.imgur.com/b3HdF7B.jpeg', duration: 5000 }
            ],
            'CandyLovers': [ 
                 { type: 'image', url: 'https://i.imgur.com/6lhpSrE.png', duration: 5000 }
            ],
            'Candies': [ 
                 { type: 'video', url: 'https://i.imgur.com/b3GUS5O.mp4', duration: 15000 }
            ]
        };

        // --- HASHTAGS GLOBALES ---
        const GLOBAL_HASHTAGS = ['#CaptainCandyUSA', '#CandyTreasure', '#PirateCandy', '#MiamiCandyShop', '#AventuraMall', '#SweetAdventure', '#CandyLovers', '#TasteTheWorld', '#ChocolateLoot', '#CandyFromEveryPort', '#LincolnRoad', '#MiamiBeach', '#ForeignCandy'];

        // --- DATA DEL FEED ---
        const FEED_DATA = [
          // ==============================
          // SEMANA 4 (22 Dic - 26 Dic)
          // ==============================

          // Friday 26: The Biggest Lie (ASMR Humor)
          {
            id: 24,
            type: 'reel',
            day: 'Fri Dec 26',
            imageType: 'gradient-6',
            icon: 'ü§•',
            title: 'The Biggest Lie',
            objective: 'Humor / Relatable',
            stats: { views: '28.1k', likes: 1850 },
            visualMediaUrl: 'https://i.imgur.com/tRiB9ki.mp4',
            downloadUrl: 'https://drive.google.com/open?id=1Qoo1xuldOwcjkBND5a88kXGVYS02lOrB&usp=drive_fs',
            copy: "The biggest lie I tell myself every weekend. ü§•üç¨\n\nMe: \"I‚Äôm just going to try a sample.\" Also me: Proceeds to fill the entire bag.\n\nLet's be real... self-control doesn't exist at Captain Candy. Once you start scooping, you can't stop. üõë‚úã\n\nüëá Tag the friend who has absolutely ZERO chill with candy.",
            hashtags: ['#CandyAddict', '#Relatable', '#MiamiEats', '#WeekendVibes', ...GLOBAL_HASHTAGS.slice(0, 5)]
          },

          // Thursday 25: Gluten Free Collection (Updated Copy)
          {
            id: 19,
            type: 'carousel',
            day: 'Thu Dec 25',
            imageType: 'gradient-2',
            icon: 'üåæ',
            title: 'Gluten Free Collection',
            objective: 'Product / Niche',
            stats: { views: '5.4k', likes: 320 },
            media: [
                { type: 'image', url: 'https://i.imgur.com/8lq7sIW.jpeg', downloadUrl: 'https://drive.google.com/open?id=19xgj0_FFQsyFCEt0ibMymJ6ZFrioy78l&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/lDUISBY.jpeg', downloadUrl: 'https://drive.google.com/open?id=14WcdapywuyVYhShIrVeiDtzksfwZrZTB&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/pK8x3ES.jpeg', downloadUrl: 'https://drive.google.com/open?id=1Pd1et3qKpSOGyvGzJPTryOncax_77Pep&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/z94BcP8.png', downloadUrl: 'https://drive.google.com/open?id=1I4Rch_TAxZpbAdENdluSOoiwvIsjrUBj&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/0KeUfHo.png', downloadUrl: 'https://drive.google.com/open?id=1pvJmQ4mZJHVk_cOtIiSp6gM2nPelcN3V&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/KNlb5hE.jpeg', downloadUrl: 'https://drive.google.com/open?id=1yWV05pUOQE2rFVDpq6OPkg1E9gR8Z9z-&usp=drive_fs' }
            ],
            visualMediaUrl: 'https://i.imgur.com/8lq7sIW.jpeg', 
            copy: "Gluten-Free, without the compromise. ‚ú®\nEveryone deserves a treat. That‚Äôs why our Gluten-Free collection is just as soft and flavorful as the rest. Honestly, you might even double-check the label just to be sure. üòâ\nüçì Featured in this post:\n1Ô∏è‚É£ Wild Strawberries\n2Ô∏è‚É£ Filled Gummy Bears\n3Ô∏è‚É£ Chocolate Coins\nAll flavor, no worries. Come mix your favorites at Lincoln Road! üìç",
            hashtags: ['#GlutenFreeMiami', '#GlutenFreeCandy', '#InclusiveTreats', ...GLOBAL_HASHTAGS.slice(0, 5)]
          },

          // Wednesday 24: Santa Spotted (Updated Copy)
          {
            id: 23,
            type: 'reel',
            day: 'Wed Dec 24',
            imageType: 'gradient-5',
            icon: 'üéÖ',
            title: 'Santa Spotted!',
            objective: 'Seasonal / Viral',
            stats: { views: '25.4k', likes: 2100 },
            visualMediaUrl: 'https://i.imgur.com/fNqEgqG.mp4',
            downloadUrl: 'https://drive.google.com/open?id=1PfFFHAjePCPMTAfFvYJkHWQ8Q1s_sgX6&usp=drive_fs',
            copy: "Looks like Santa has a new favorite stop on Lincoln Road. üéÖ‚ú®\nWe spotted the sleigh loading up on something special this year. Because let‚Äôs be honest: the best gifts usually don't fit in a box‚Äîthey come in a bag of premium sweets. üç´\nSkip the socks this season. Treat your loved ones (and yourself) to the kind of treasure that actually gets eaten.\nüìç Upgrade your stockings at Captain Candy Shop.",
            hashtags: ['#SantaSpotted', '#MiamiChristmas', '#StockingStuffers', '#LincolnRoad', '#BreakingNewsMiami']
          },

          // Tuesday 23: 10+ Countries (Updated Copy)
          {
            id: 22,
            type: 'reel',
            day: 'Tue Dec 23',
            imageType: 'gradient-4',
            icon: 'üåç',
            title: '10+ Countries',
            objective: 'Product / Authority',
            stats: { views: '19.2k', likes: 1350 },
            visualMediaUrl: 'https://i.imgur.com/Myasbaf.mp4',
            downloadUrl: 'https://drive.google.com/open?id=1KmzatuzFcWjSrHmAUf09tjP8MYb9xgpK&usp=drive_fs',
            copy: "10+ Countries. One Bag. Zero Regrets. üòå\nWe‚Äôve gathered the finest chocolates from Brazil, Germany, Spain, Belgium, and beyond. At Captain Candy, we curate the ultimate treasure chest so you simply don't have to choose.\nThe world‚Äôs best sweets, all right here on Lincoln Road. üìç",
            hashtags: GLOBAL_HASHTAGS.slice(0, 8)
          },

          // Monday 22: COTW - Jumbo Fruits
          {
            id: 20,
            type: 'carousel',
            day: 'Mon Dec 22',
            imageType: 'gradient-2',
            icon: 'üåà',
            title: 'COTW: Jumbo Fruits',
            objective: 'Product / Highlight',
            stats: { views: '3.2k', likes: 150 },
            media: [
                { type: 'image', url: 'https://i.imgur.com/oIZvorD.jpeg', downloadUrl: 'https://drive.google.com/open?id=1HdHNpstWVvB-5AlsebNPoR-65GMRDwaq&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/eV7yhwC.jpeg', downloadUrl: 'https://drive.google.com/file/d/15bOCjhq3ni2exByuI1Nh-2h-FxXtm0UW/view?usp=sharing' },
                { type: 'video', url: 'https://i.imgur.com/dQPE4zx.mp4', downloadUrl: 'https://drive.google.com/open?id=10rZjxPvX722vkV4Enpgy_7iNRAoAZDwk&usp=drive_fs' }
            ],
            visualMediaUrl: 'https://i.imgur.com/oIZvorD.jpeg',
            copy: "üåà Candy of the Week: JUMBO Multi Fruits!\n\nWhy pick one flavor when you can have them all? These aren't your average sweets. They are JUMBO in size and JUMBO in flavor. üí• Filled with a mix of fruity goodness. The perfect balance of sweet, chewy, and totally addictive.\n\n#CandyOfTheWeek #JumboCandy #FruitLovers",
            hashtags: ['#CandyOfTheWeek', ...GLOBAL_HASHTAGS].slice(0, 8)
          },


          // ==============================
          // SEMANA 3 (15 Dic - 19 Dic)
          // ==============================

          // Friday 19: Caught the Vibe
          {
            id: 16,
            type: 'carousel',
            day: 'Fri Dec 19',
            imageType: 'gradient-1',
            icon: 'üì∏',
            title: 'Caught the Vibe',
            objective: 'Social Proof / Lifestyle',
            stats: { views: '3.5k', likes: 210 },
            media: [
                { type: 'image', url: 'https://i.imgur.com/fGz2oFZ.jpeg', downloadUrl: 'https://drive.google.com/open?id=1PFdvUUYVPXqFYMf15BTH2v-w0yS1MfXp&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/UR6duAS.jpeg', downloadUrl: 'https://drive.google.com/open?id=1upqVJbQ633zFuyMetbreRHbDxJ4WqaKS&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/y4x7h8u.jpeg', downloadUrl: 'https://drive.google.com/open?id=1kdGEupeJlpD87JqGntoiMcI6x8aQHO8j&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/sLaL62z.jpeg', downloadUrl: 'https://drive.google.com/open?id=1IbxFQPeiBbpBU8b6bI-gO_2PBjPNEcgY&usp=drive_fs' }
            ],
            visualMediaUrl: 'https://i.imgur.com/fGz2oFZ.jpeg',
            copy: "POV: You caught the Captain Candy vibe. üì∏‚ú®\n\nIt‚Äôs not just about the sugar... it‚Äôs about the smile that comes with it. From the moment you secure the bag to that very first bite of a blue shark ü¶à, the experience is unmatched.\n\nSwipe ‚û°Ô∏è to see happy faces and full hands. This is what a successful treasure hunt looks like.\n\nüëá Who is your partner in crime for a candy run? Tag them!",
            hashtags: GLOBAL_HASHTAGS.slice(0, 10)
          },

          // Thursday 18: POV Sweetest Spot (Updated Copy)
          {
            id: 18,
            type: 'reel',
            day: 'Thu Dec 18',
            imageType: 'gradient-3',
            icon: 'üìç',
            title: 'POV: Sweetest Spot',
            objective: 'Branding / Aesthetic',
            stats: { views: '14.5k', likes: 890 },
            visualMediaUrl: 'https://i.imgur.com/gWrMzLx.mp4',
            downloadUrl: 'https://drive.google.com/open?id=12N0rTLOTvWKieL5nsUgDkUYTMoTzrb3I&usp=drive_fs',
            copy: "POV: You just found the sweetest spot in Miami. üìç‚òÄÔ∏è\n\nWe are talking about European textures, vibrant colors, and flavors that actually taste like fruit (and real chocolate!).\n\nLife is short. Make it sweet. üç≠\n\nüöÄ Tag your candy buddy to plan your next visit",
            hashtags: ['#POV', '#MiamiSpots', '#NoFilterNeeded', ...GLOBAL_HASHTAGS.slice(0, 5)]
          },

          // Wednesday 17: Safe Space
          {
            id: 21,
            type: 'reel',
            day: 'Wed Dec 17',
            imageType: 'gradient-1',
            icon: 'üé∂',
            title: 'Safe Space',
            objective: 'Vibe / Lifestyle',
            stats: { views: '15.8k', likes: 980 },
            visualMediaUrl: 'https://i.imgur.com/WL7DmSp.mp4',
            downloadUrl: 'https://drive.google.com/open?id=1MHF62Kv0E6ZZY6Sn8aap31LfAkARr9ge&usp=drive_fs',
            copy: "Your safe space for sugar cravings. üé∂‚ú®\n\n\"I could lift you up...\" literally. üöÄ Nothing fixes a bad day like a scoop of your favorite candy. From the moment you step under the ropes, the vibe changes. Good music, amazing smells, and rows of candy waiting for you.\n\nCome for the candy, stay for the vibes. ü¶ú",
            hashtags: ['#CandyVibes', '#MiamiLifestyle', '#SweetEscape', ...GLOBAL_HASHTAGS.slice(0, 5)]
          },

          // Tuesday 16: ASMR Crunch
          {
            id: 17,
            type: 'reel',
            day: 'Tue Dec 16',
            imageType: 'gradient-6',
            icon: 'üîä',
            title: 'ASMR Crunch',
            objective: 'Sensory / Engagement',
            stats: { views: '22.1k', likes: 1600 },
            visualMediaUrl: 'https://i.imgur.com/eFF0hY7.mp4',
            downloadUrl: 'https://drive.google.com/file/d/1_xhcXq9NKFXcjNQtb91ZBBL8Swyaz8r_/view?usp=sharing',
            copy: "Oddly satisfying? No, just delicious. ü§§üîä\n\nTurn your volume UP. üîâ That crunch you hear? That‚Äôs the sound of premium, high-quality chocolate hitting the scoop. No plastic, no fake stuff. Just real cocoa and the perfect texture.\n\nüëá Rate this crunch from 1 to 10!",
            hashtags: ['#ASMR', '#OddlySatisfying', '#ChocolateCrunch', '#FoodPorn']
          },

          // Monday 15: COTW - Milk vs Dark (Opens Week 3)
          {
            id: 15,
            type: 'carousel',
            day: 'Mon Dec 15',
            imageType: 'gradient-2',
            icon: 'üç´',
            title: 'COTW: Milk vs Dark',
            objective: 'Product / Dilemma',
            stats: { views: '4.2k', likes: 310 },
            media: [
                { type: 'image', url: 'https://i.imgur.com/nKwHMRD.jpeg', downloadUrl: 'https://drive.google.com/open?id=1OLQUnHlwqjHgeMXXlxqK31Qe5howm1Vd&usp=drive_fs' },
                { type: 'image', url: 'https://i.imgur.com/pNXkm8B.jpeg', downloadUrl: 'https://drive.google.com/open?id=1hAayyLCJrE05vGpibFBSu5-kz4S7dLmH&usp=drive_fs' },
                { type: 'video', url: 'https://i.imgur.com/YTOeAIV.mp4', downloadUrl: 'https://drive.google.com/open?id=1JHPCLdXeLfWIKpOuLAu5NW5nj_QTtQyq&usp=drive_fs' }
            ],
            visualMediaUrl: 'https://i.imgur.com/nKwHMRD.jpeg',
            copy: "Team Milk üÜö Team Dark. Why choose? üç´‚öñÔ∏è\n\nLife is full of hard choices, but this bag shouldn't be one of them. Our Candy of the Week gives you the best of both worlds: ‚ú® Milk Chocolate: Creamy, sweet, and comforting. üåë Dark Chocolate: Rich, intense, and sophisticated. üå∞ The Core: A perfectly roasted, crunchy almond.\n\nThis is the ultimate power couple.\n\nüëá Which one do you fish out of the bag first?",
            hashtags: ['#TeamMilk', '#TeamDark', '#ChocolateLover', ...GLOBAL_HASHTAGS.slice(0, 6)]
          },
        ];

        // --- COMPONENTES UI ---

        // StoryViewer
        const StoryViewer = ({ category, onClose }) => {
            const stories = STORIES_DATA[category] || [];
            const [currentIndex, setCurrentIndex] = useState(0);
            const [paused, setPaused] = useState(false);
            const videoRef = useRef(null);

            const currentStory = stories[currentIndex];

            useEffect(() => {
                if (!currentStory || paused) return;

                const timer = setTimeout(() => {
                    handleNext();
                }, currentStory.duration);

                return () => clearTimeout(timer);
            }, [currentIndex, paused, currentStory]);

            // Reset video time when slide changes
             useEffect(() => {
                if (videoRef.current) {
                    videoRef.current.currentTime = 0;
                    videoRef.current.play();
                }
            }, [currentIndex]);


            const handleNext = () => {
                if (currentIndex < stories.length - 1) {
                    setCurrentIndex(prev => prev + 1);
                } else {
                    onClose();
                }
            };

            const handlePrev = () => {
                if (currentIndex > 0) {
                    setCurrentIndex(prev => prev - 1);
                }
            };

            if (!currentStory) return null;

            return (
                <div className="fixed inset-0 z-[300] bg-black flex items-center justify-center animate-in fade-in duration-200">
                    {/* Story Container Mobile Aspect Ratio */}
                    <div className="relative w-full h-full md:max-w-md md:h-[90vh] md:rounded-xl overflow-hidden bg-gray-900 shadow-2xl">
                        
                        {/* Progress Bars */}
                        <div className="absolute top-4 left-2 right-2 flex gap-1 z-20">
                            {stories.map((story, idx) => (
                                <div key={idx} className="h-0.5 bg-white/30 flex-1 rounded-full overflow-hidden">
                                    <div 
                                        className={`h-full bg-white transition-all duration-300 ease-linear ${
                                            idx < currentIndex ? 'w-full' : 
                                            idx === currentIndex ? (paused ? 'w-full opacity-50' : 'animate-progress') : 'w-0'
                                        }`}
                                        style={{ 
                                            animationDuration: idx === currentIndex ? `${story.duration}ms` : '0ms',
                                            animationPlayState: paused ? 'paused' : 'running'
                                        }}
                                    />
                                </div>
                            ))}
                        </div>

                        {/* Header Info */}
                        <div className="absolute top-8 left-4 z-20 flex items-center gap-2">
                             <div className="w-8 h-8 rounded-full bg-gradient-to-tr from-yellow-400 to-red-500 p-[2px]">
                                <div className="w-full h-full rounded-full bg-white flex items-center justify-center text-[10px] overflow-hidden">
                                     <img src="https://captaincandyspain.com/wp-content/uploads/2020/12/logo-banner-inicio.png" className="w-full h-full object-contain p-[1px] scale-110" />
                                </div>
                            </div>
                            <span className="text-white text-sm font-bold shadow-black drop-shadow-md">{category}</span>
                            <span className="text-white/60 text-xs font-light">1h</span>
                        </div>

                        {/* Close Button */}
                        <button onClick={onClose} className="absolute top-8 right-4 z-30 text-white hover:text-gray-300">
                            <X size={28} />
                        </button>

                         {/* Play/Pause Button (Hidden but usable via long press simulation) */}
                         <button 
                            className="absolute bottom-4 right-4 z-30 text-white/50 hover:text-white"
                            onClick={(e) => { e.stopPropagation(); setPaused(!paused); }}
                        >
                            {paused ? <Play size={20} fill="currentColor" /> : <Pause size={20} fill="currentColor" />}
                        </button>

                        {/* Navigation Overlay (Invisible) */}
                        <div className="absolute inset-0 z-10 flex">
                            <div className="w-1/3 h-full" onClick={handlePrev}></div>
                            <div className="w-2/3 h-full" onClick={handleNext}></div>
                        </div>

                        {/* Media */}
                        <div className="w-full h-full flex items-center justify-center bg-black">
                            {currentStory.type === 'video' ? (
                                <video 
                                    ref={videoRef}
                                    src={currentStory.url} 
                                    className="w-full h-full object-cover" 
                                    autoPlay 
                                    muted={false} 
                                    playsInline
                                    onEnded={handleNext}
                                />
                            ) : (
                                <img src={currentStory.url} className="w-full h-full object-cover animate-in fade-in zoom-in duration-500" />
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const Modal = ({ isOpen, onClose, post }) => {
            const [currentSlide, setCurrentSlide] = useState(0);

            useEffect(() => {
                if (isOpen) setCurrentSlide(0);
            }, [isOpen, post]);

            if (!isOpen || !post) return null;

            // Determinar el asset actual (imagen/video)
            const isCarousel = post.type === 'carousel' && post.media && post.media.length > 0;
            const currentAsset = isCarousel 
                ? post.media[currentSlide] 
                : { type: post.type === 'reel' ? 'video' : 'image', url: post.visualMediaUrl, downloadUrl: post.downloadUrl };

            if (!currentAsset) return null;

            // LOGICA PARA EL LINK DE DESCARGA
            const hasSpecificLink = currentAsset.downloadUrl && currentAsset.downloadUrl !== '#' && currentAsset.downloadUrl.trim() !== '';
            const finalDownloadUrl = hasSpecificLink ? currentAsset.downloadUrl : MAIN_DRIVE_FOLDER;
            const downloadText = hasSpecificLink 
                ? (isCarousel ? `Download Slide ${currentSlide + 1}` : 'Download High-Res')
                : 'Find in Drive Folder';
            const DownloadIcon = hasSpecificLink ? Download : ExternalLink;

            const nextSlide = (e) => {
                e.stopPropagation();
                if (currentSlide < post.media.length - 1) setCurrentSlide(prev => prev + 1);
            };

            const prevSlide = (e) => {
                e.stopPropagation();
                if (currentSlide > 0) setCurrentSlide(prev => prev - 1);
            };

            return (
                <div className="fixed inset-0 z-[200] flex items-center justify-center p-4 bg-black/80 backdrop-blur-sm animate-in fade-in duration-200" onClick={onClose}>
                    <div className="bg-white dark:bg-gray-900 w-full max-w-5xl h-[90vh] rounded-xl overflow-hidden flex flex-col md:flex-row shadow-2xl border border-gray-800" onClick={e => e.stopPropagation()}>
                        {/* Visual */}
                        <div className="w-full md:w-1/2 h-1/2 md:h-full bg-black relative flex items-center justify-center overflow-hidden group">
                            <div className="absolute inset-0 z-0 opacity-60">
                                {currentAsset.type === 'video' || post.type === 'reel' ? (
                                    <video src={currentAsset.url} className="w-full h-full object-cover blur-2xl scale-110" autoPlay muted loop playsInline />
                                ) : (
                                    <img src={currentAsset.url} className="w-full h-full object-cover blur-2xl scale-110" />
                                )}
                            </div>
                            <div className="relative z-10 w-full h-full flex items-center justify-center p-2">
                                {currentAsset.type === 'video' || post.type === 'reel' ? (
                                    <video key={`vid-${currentSlide}`} src={currentAsset.url} className="h-full w-full object-contain drop-shadow-2xl rounded-sm" controls autoPlay muted loop playsInline />
                                ) : (
                                    <img key={`img-${currentSlide}`} src={currentAsset.url} className="h-full w-full object-contain drop-shadow-2xl rounded-sm" />
                                )}
                            </div>
                            {isCarousel && (
                                <>
                                    {currentSlide > 0 && <button onClick={prevSlide} className="absolute left-4 top-1/2 -translate-y-1/2 z-30 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full backdrop-blur-sm"><ChevronLeft size={24} /></button>}
                                    {currentSlide < post.media.length - 1 && <button onClick={nextSlide} className="absolute right-4 top-1/2 -translate-y-1/2 z-30 bg-black/50 hover:bg-black/70 text-white p-2 rounded-full backdrop-blur-sm"><ChevronRight size={24} /></button>}
                                    <div className="absolute top-4 left-4 bg-black/50 px-3 py-1 rounded-full text-xs font-mono text-white/90 backdrop-blur-md z-20">
                                        {currentSlide + 1}/{post.media.length}
                                    </div>
                                </>
                            )}
                        </div>
                        {/* Info & Data */}
                        <div className="w-full md:w-1/2 h-1/2 md:h-full flex flex-col bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100">
                            <div className="p-4 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between shrink-0">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-yellow-400 to-red-500 p-[2px]">
                                        <div className="w-full h-full rounded-full bg-white flex items-center justify-center text-xs overflow-hidden">
                                            <img src="https://captaincandyspain.com/wp-content/uploads/2020/12/logo-banner-inicio.png" className="w-full h-full object-contain p-[1px] scale-110" />
                                        </div>
                                    </div>
                                    <span className="font-bold text-sm">captaincandyshop</span>
                                </div>
                                <button onClick={onClose} className="text-gray-500 hover:text-red-500 transition-colors"><X size={24} /></button>
                            </div>
                            <div className="flex-1 overflow-y-auto p-6 space-y-6">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg border border-blue-100 dark:border-blue-800">
                                        <p className="text-xs text-blue-600 dark:text-blue-400 font-bold uppercase tracking-wider mb-1">Post Date</p>
                                        <div className="flex items-center gap-2 text-blue-900 dark:text-blue-100 font-medium"><Calendar size={16} /> {post.day}</div>
                                    </div>
                                    <div className="bg-purple-50 dark:bg-purple-900/20 p-3 rounded-lg border border-purple-100 dark:border-purple-800">
                                        <p className="text-xs text-purple-600 dark:text-purple-400 font-bold uppercase tracking-wider mb-1">Objective</p>
                                        <div className="flex items-center gap-2 text-purple-900 dark:text-purple-100 font-medium"><Target size={16} /> {post.objective}</div>
                                    </div>
                                </div>
                                <div className="space-y-2">
                                    <h3 className="text-xs font-bold uppercase text-gray-400 tracking-widest">Caption</h3>
                                    <div className="text-sm leading-relaxed whitespace-pre-line font-light border-l-2 border-yellow-500 pl-4 py-1">{post.copy}</div>
                                </div>
                                <div className="space-y-2">
                                    <h3 className="text-xs font-bold uppercase text-gray-400 tracking-widest">Hashtags</h3>
                                    <div className="flex flex-wrap gap-2">
                                        {post.hashtags.map((tag, i) => <span key={i} className="text-xs bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 px-2 py-1 rounded-md font-mono">{tag}</span>)}
                                    </div>
                                </div>
                            </div>
                            <div className="p-4 border-t border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center shrink-0">
                                <div className="flex gap-4 text-gray-400">
                                    <span className="flex items-center gap-1 text-xs"><Heart size={14} /> {post.stats.likes}</span>
                                    <span className="flex items-center gap-1 text-xs"><MessageCircle size={14} /> 42</span>
                                </div>
                                <a href={finalDownloadUrl} target="_blank" rel="noopener noreferrer" className={`text-black text-sm font-bold py-2 px-4 rounded-lg flex items-center gap-2 transition-all shadow-lg ${hasSpecificLink ? 'bg-yellow-500 hover:bg-yellow-400 shadow-yellow-500/20' : 'bg-gray-200 hover:bg-gray-300 text-gray-700'}`}>
                                    <DownloadIcon size={16} /> {downloadText}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [loading, setLoading] = useState(true);
            const [progress, setProgress] = useState(0);
            const [selectedPost, setSelectedPost] = useState(null);
            const [isDownloading, setIsDownloading] = useState(false);
            const [activeStoryCategory, setActiveStoryCategory] = useState(null);

            // --- LOGICA DE PRECARGA INTELIGENTE ---
            useEffect(() => {
                let allUrls = [];
                // Feed Assets
                FEED_DATA.forEach(post => {
                    if (post.type === 'carousel' && post.media) {
                        post.media.forEach(m => allUrls.push(m.url));
                    } else {
                        allUrls.push(post.visualMediaUrl);
                    }
                });
                // Story Assets
                Object.values(STORIES_DATA).flat().forEach(s => allUrls.push(s.url));
                // Logo
                allUrls.push("https://captaincandyspain.com/wp-content/uploads/2020/12/logo-banner-inicio.png");

                let loadedCount = 0;
                const total = allUrls.length;

                const updateProgress = () => {
                    loadedCount++;
                    const percent = Math.floor((loadedCount / total) * 100);
                    setProgress(percent);
                    if (loadedCount >= total) {
                        setTimeout(() => setLoading(false), 500);
                    }
                };

                if (total === 0) setLoading(false);

                allUrls.forEach(url => {
                    if (!url) { updateProgress(); return; }
                    if (url.endsWith('.mp4')) {
                        const video = document.createElement('video');
                        video.onloadeddata = updateProgress;
                        video.onerror = updateProgress;
                        video.src = url;
                        video.preload = 'auto';
                        video.load();
                    } else {
                        const img = new Image();
                        img.onload = updateProgress;
                        img.onerror = updateProgress;
                        img.src = url;
                    }
                });
            }, []);

            const handleDownloadAll = () => {
                setIsDownloading(true);
                setTimeout(() => {
                    setIsDownloading(false);
                    window.open(MAIN_DRIVE_FOLDER, '_blank');
                }, 1500);
            };

            return (
                <div className="relative min-h-screen bg-gray-50 dark:bg-black text-gray-900 dark:text-white font-sans transition-colors duration-300">
                    
                    {/* LOADER */}
                    <div className={`fixed inset-0 z-[100] flex flex-col items-center justify-center bg-gray-50 dark:bg-black transition-all duration-700 ${!loading ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}>
                        <div className="flex flex-col items-center gap-6">
                            <div className="w-20 h-20 rounded-full bg-gradient-to-tr from-yellow-400 to-red-500 p-[3px] shadow-2xl animate-loader">
                                <div className="w-full h-full rounded-full bg-white flex items-center justify-center text-3xl">üç¨</div>
                            </div>
                            <div className="flex flex-col items-center gap-2">
                                <p className="text-xs font-bold text-gray-400 uppercase tracking-widest">Loading Content</p>
                                <div className="w-48 h-1 bg-gray-200 rounded-full overflow-hidden">
                                    <div className="h-full bg-yellow-500 transition-all duration-300 ease-out" style={{width: `${progress}%`}}></div>
                                </div>
                                <p className="text-[10px] text-gray-400">{progress}%</p>
                            </div>
                        </div>
                    </div>

                    {/* DISCLAIMER */}
                    <div className="bg-yellow-100 dark:bg-yellow-900/40 border-b border-yellow-200 dark:border-yellow-800 text-yellow-800 dark:text-yellow-200 text-[10px] sm:text-xs font-bold text-center py-2 px-4 flex items-center justify-center gap-2 sticky top-0 z-50">
                        <AlertTriangle size={14} />
                        VISUALIZER MODE: Instant View
                    </div>

                    {/* NAV */}
                    <nav className="sticky top-[34px] z-40 bg-white/90 dark:bg-black/90 backdrop-blur-xl border-b border-gray-200 dark:border-gray-800 px-4 py-3 flex justify-between items-center">
                        <div className="font-bold text-lg tracking-tight flex items-center gap-2"><span>üç¨</span> Captain Candy Manager</div>
                        <button onClick={handleDownloadAll} className="bg-blue-600 hover:bg-blue-500 text-white text-xs md:text-sm font-bold py-2 px-4 rounded-full transition-all flex items-center gap-2 shadow-lg shadow-blue-600/20">
                            {isDownloading ? 'Opening Drive...' : <><Download size={16} /> <span className="hidden sm:inline">Download All Assets</span></>}
                        </button>
                    </nav>

                    <div className="max-w-4xl mx-auto pb-20">
                        <header className="px-4 py-8 md:px-8 md:py-12">
                            <div className="flex flex-col md:flex-row items-center md:items-start gap-6 md:gap-10">
                                <div className="relative group cursor-pointer">
                                    <div className="w-28 h-28 md:w-40 md:h-40 rounded-full p-[3px] bg-gradient-to-tr from-yellow-400 via-red-500 to-purple-600 shadow-xl">
                                        <div className="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden relative border-4 border-white shadow-inner">
                                            <img src="https://captaincandyspain.com/wp-content/uploads/2020/12/logo-banner-inicio.png" className="w-full h-full object-contain p-1 scale-110 group-hover:scale-125 transition-transform duration-300 ease-out" />
                                        </div>
                                    </div>
                                    <div className="absolute bottom-2 right-2 bg-blue-500 text-white rounded-full p-1.5 border-4 border-black"><div className="w-4 h-4 flex items-center justify-center font-bold text-xs">+</div></div>
                                </div>

                                <div className="flex-1 text-center md:text-left">
                                    <div className="flex flex-col md:flex-row items-center gap-4 mb-4">
                                        <h1 className="text-xl md:text-2xl font-light">captaincandyshop</h1>
                                        <div className="flex gap-2">
                                            <span className="px-4 py-1.5 bg-gray-200 dark:bg-gray-800 rounded-lg text-sm font-semibold cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-700 transition">Edit profile</span>
                                            <span className="px-4 py-1.5 bg-gray-200 dark:bg-gray-800 rounded-lg text-sm font-semibold cursor-pointer hover:bg-gray-300 dark:hover:bg-gray-700 transition">Tools</span>
                                        </div>
                                    </div>
                                    <div className="flex justify-center md:justify-start gap-8 mb-4 text-sm md:text-base">
                                        <div><span className="font-bold">{FEED_DATA.length}</span> posts</div>
                                        <div><span className="font-bold">14.3k</span> followers</div>
                                        <div><span className="font-bold">342</span> following</div>
                                    </div>
                                    <div className="text-sm leading-snug max-w-md mx-auto md:mx-0">
                                        <p className="font-bold">Captain Candy Shop ‚öìÔ∏èüç≠</p>
                                        <p className="text-gray-400">Boutique Candy Store</p>
                                        <p>üìç Miami | Unforgettable Experiences</p>
                                        <p>üç´ Exclusive selection of Fine European Chocolates.</p>
                                        <p>üè¥‚Äç‚ò†Ô∏è Discover the taste of our most valuable treasure.</p>
                                        <p>üëá Join the Captain's VIP Crew!</p>
                                        <a href="#" className="text-blue-400 font-medium hover:underline">bit.ly/captain-candy-crew</a>
                                    </div>
                                </div>
                            </div>

                            {/* STORIES */}
                            <div className="flex gap-4 overflow-x-auto mt-8 pb-2 md:pb-0 scrollbar-hide justify-center md:justify-start">
                                {[
                                    { icon: <Crown size={28} strokeWidth={1.5} />, label: 'Boutique' },
                                    { icon: <Gem size={28} strokeWidth={1.5} />, label: 'Chocolates' },
                                    { icon: <Star size={28} strokeWidth={1.5} />, label: 'Reviews' },
                                    { icon: <Heart size={28} strokeWidth={1.5} />, label: 'CandyLovers' }, 
                                    { icon: <Cookie size={28} strokeWidth={1.5} />, label: 'Candies' }, 
                                ].map((story, idx) => (
                                    <div key={idx} 
                                        onClick={() => setActiveStoryCategory(story.label)}
                                        className="flex flex-col items-center space-y-1 min-w-[70px] cursor-pointer opacity-90 hover:opacity-100 transition-opacity transform hover:scale-105 duration-200"
                                    >
                                        <div className="w-16 h-16 rounded-full bg-[#5D4037] border-2 border-[#8D6E63] p-1 shadow-lg ring-2 ring-black/20">
                                            <div className="w-full h-full bg-[#3E2723] rounded-full flex items-center justify-center text-yellow-400 border border-[#4E342E] shadow-inner">
                                                {story.icon}
                                            </div>
                                        </div>
                                        <span className="text-xs font-medium truncate w-16 text-center mt-1 text-gray-600 dark:text-gray-400">{story.label}</span>
                                    </div>
                                ))}
                            </div>
                        </header>

                        <div className="border-t border-gray-200 dark:border-gray-800">
                            <div className="flex justify-center gap-12 text-xs font-bold tracking-widest uppercase py-4">
                                <div className="flex items-center gap-2 border-t-2 border-white dark:border-white pt-1 -mt-4 cursor-pointer"><Grid size={12} /> Posts</div>
                                <div className="flex items-center gap-2 text-gray-400 cursor-pointer hover:text-gray-200 transition"><Film size={12} /> Reels</div>
                            </div>

                            <div className="grid grid-cols-3 gap-0.5 md:gap-4 px-0 md:px-4">
                                {FEED_DATA.map((post) => {
                                    const gridMediaUrl = (post.type === 'carousel' && post.media && post.media.length > 0) 
                                        ? post.media[0].url 
                                        : post.visualMediaUrl;
                                    
                                    return (
                                        <div key={post.id} onClick={() => setSelectedPost(post)} className="relative group aspect-[9/16] cursor-pointer overflow-hidden bg-gray-800 md:rounded-lg border border-gray-800">
                                            {gridMediaUrl ? (
                                                post.type === 'reel' ? (
                                                    <video 
                                                        src={gridMediaUrl} 
                                                        className="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition-opacity" 
                                                        muted 
                                                        loop 
                                                        playsInline 
                                                        autoPlay 
                                                    />
                                                ) : (
                                                    <img 
                                                        src={gridMediaUrl} 
                                                        alt={post.title} 
                                                        className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" 
                                                        loading="eager" 
                                                        decoding="sync"
                                                    />
                                                )
                                            ) : (
                                                <div className="w-full h-full bg-gray-700 flex items-center justify-center"><span className="text-4xl">{post.icon}</span></div>
                                            )}
                                            <div className="absolute top-2 right-2 text-white drop-shadow-md opacity-90 z-10">
                                                {post.type === 'reel' && <Film size={16} strokeWidth={2.5} />}
                                                {post.type === 'carousel' && <Layers size={16} strokeWidth={2.5} />}
                                            </div>
                                            <div className="absolute inset-0 bg-black/20 group-hover:bg-transparent transition-colors duration-300 pointer-events-none"></div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    </div>
                    {/* MODALES */}
                    <Modal isOpen={!!selectedPost} onClose={() => setSelectedPost(null)} post={selectedPost} />
                    {activeStoryCategory && (
                        <StoryViewer category={activeStoryCategory} onClose={() => setActiveStoryCategory(null)} />
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>